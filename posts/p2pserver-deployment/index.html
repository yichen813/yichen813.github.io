<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="P2PServer deployment">
<meta itemprop="description" content="P2P Server 部署 尚云互联服务器部署说明书 深圳市尚云互联技术有限公司 yc v1.2.0(2019.11.12) 版权宣告与免责声明 版权声明： 本文之所有内容(包括但不限于文字内容与图片)，均为">
<meta itemprop="datePublished" content="2019-12-06T19:26:26&#43;08:00" />
<meta itemprop="dateModified" content="2019-12-06T19:26:26&#43;08:00" />
<meta itemprop="wordCount" content="3659">



<meta itemprop="keywords" content="" /><meta property="og:title" content="P2PServer deployment" />
<meta property="og:description" content="P2P Server 部署 尚云互联服务器部署说明书 深圳市尚云互联技术有限公司 yc v1.2.0(2019.11.12) 版权宣告与免责声明 版权声明： 本文之所有内容(包括但不限于文字内容与图片)，均为" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yichen813.github.io/posts/p2pserver-deployment/" />
<meta property="article:published_time" content="2019-12-06T19:26:26+08:00" />
<meta property="article:modified_time" content="2019-12-06T19:26:26+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="P2PServer deployment"/>
<meta name="twitter:description" content="P2P Server 部署 尚云互联服务器部署说明书 深圳市尚云互联技术有限公司 yc v1.2.0(2019.11.12) 版权宣告与免责声明 版权声明： 本文之所有内容(包括但不限于文字内容与图片)，均为"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>P2PServer deployment</title>
	<link rel="stylesheet" href="https://yichen813.github.io/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css" integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin="anonymous">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://yichen813.github.io">Yichen Blog</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://yichen813.github.io/posts/">文章列表</a>
				<a href="https://yichen813.github.io/about/">关于我</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://weixin.qq.com/" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://instagram.com/" target="_blank" rel="noopener me" title="Dreamstime"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19.834 20.994s4.824-4.08 2.044-12.03C19.252 1.456 6.822-1.223 2.508 7.566c-3.936 8.023 2.18 14.46 7.88 14.374 4.889-.075 8.475-3.226 7.813-8.604-.76-6.18-6.73-6.816-9.275-4.184-2.256 2.334-1.816 7.034.873 7.823 2.241.844 4.661-1.265 3.161-3.215" style="font-variation-settings:normal" stroke="currentColor" stroke-linejoin="bevel" paint-order="stroke fill markers"/></svg></a><a href="about/" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://yichen813.github.io/posts/">文章列表</a></li>
			<li><a href="https://yichen813.github.io/about/">关于我</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Dec 6, 2019</span></div>
				<h1>P2PServer deployment</h1>
			</header>
			<div class="content">
				<h1 id="p2p-server-">P2P Server 部署<a href="#p2p-server-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<blockquote>
<p><strong>尚云互联服务器部署说明书</strong></p>
<p><a href="http://www.cs2-network.cn">深圳市尚云互联技术有限公司</a>     yc  <!-- raw HTML omitted -->v1.2.0(2019.11.12)</p>
</blockquote>
<h2 id="heading">版权宣告与免责声明<a href="#heading" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<ul>
<li>
<p>版权声明：</p>
<p>本文之所有内容(包括但不限于文字内容与图片)，均为深圳市尚云互联技术有限公司所有，非经允许不得以任何形式全文或部份抄袭，引用。</p>
</li>
<li>
<p>免责声明：</p>
<p>本文之内容及信息不能保证其正确性、实时性或完整性。因为相关内容随时可能被修改或改版。</p>
</li>
<li>
<p><strong>深圳市尚云互联技术有限公司保留文档内容的最后解释修改权利</strong>。</p>
</li>
</ul>
<h2 id="heading1">修订历史<a href="#heading1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<table>
<thead>
<tr>
<th align="center">Version</th>
<th align="center">Date</th>
<th align="center">Author</th>
<th>Modification</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1.2.0</td>
<td align="center">2019/11/12</td>
<td align="center">yc</td>
<td>更新启动脚本内容。</td>
</tr>
<tr>
<td align="center">1.1.0</td>
<td align="center">2019/07/11</td>
<td align="center">yc</td>
<td>更新 Step 11。</td>
</tr>
<tr>
<td align="center">1.0.3</td>
<td align="center">2019/04/04</td>
<td align="center">yc</td>
<td>修改 Step 9 和 Step 10 的说明。</td>
</tr>
<tr>
<td align="center">1.0.2</td>
<td align="center">2019/03/11</td>
<td align="center">yc</td>
<td>修改Step 6 和 Step 7 的说明。</td>
</tr>
<tr>
<td align="center">1.0.1</td>
<td align="center">2019/03/06</td>
<td align="center">yc</td>
<td>修改Step 9的演示图片。</td>
</tr>
<tr>
<td align="center">1.0.0</td>
<td align="center">2019/02/22</td>
<td align="center">yc</td>
<td>初始版本</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p>[TOC]</p>
<!-- raw HTML omitted -->
<ul>
<li>通常使用的系统分为 Windows、macOS 和 Linux，macOS 和 Linux 可以直接通过 <em>ssh 指令</em> 用终端登录服务器，本章节主要讲 Windows 系统下的登录工具 Putty 和 上传工具 WinSCP，Putty 下载路径：<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html"><a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html</a></a> ，WiSCP 下载路径：<a href="https://winscp.net/eng/download.php"><a href="https://winscp.net/eng/download.php">https://winscp.net/eng/download.php</a></a>。</li>
</ul>
<h3 id="-putty">登录工具 Putty<a href="#-putty" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>
<p>Putty 是 Windows 系统下登录服务器的一款软件，简单使用如下：</p>
<ol>
<li>
<p>打开 Putty 软件，填写服务器 IP 或域名，回车后会弹出一个窗口，点击 <strong>是</strong>：</p>
<p><img src="picture/003/Putty%E7%99%BB%E5%BD%95.png" alt=""></p>
</li>
<li>
<p>填写登录用户名：<strong>root</strong>，回车后按提示输入密码，成功后进入服务器开始操作。</p>
<p><img src="picture/003/ssh%E7%99%BB%E5%BD%95.png" alt=""></p>
</li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>WinSCP 可以和云主机互传文件，在部署时需要将服务器程序文件上传，在Windows系统下使用本软件上传，简单使用步骤如下：</li>
</ul>
<ol>
<li>
<p>输入云主机IP或域名、用户名、密码后登录：</p>
<p><img src="picture/003/scp%E7%99%BB%E5%BD%95.png" alt=""></p>
</li>
<li>
<p>登录后，左边框内是本地文件，右边是云主机的文件，之间用鼠标拖拽文件到右边即可上传文件。</p>
<p><img src="picture/003/scp%E4%B8%8A%E4%BC%A0.png" alt=""></p>
</li>
</ol>
<!-- raw HTML omitted -->
<ul>
<li>
<p><strong>P2P Login Server</strong> 是 PPC 平台的主控服务器，通常简称为 <strong>P2P Server</strong> 或 <strong>P2P 服务器</strong>。</p>
</li>
<li>
<p>部署时需要准备服务器的程序和配置文件（请到 FTP 上下载），根据部署的云主机系统分为32位和64位的压缩包，请按照服务器的系统选择相应的服务器程序压缩包，本文档以部署Ubuntu 64位服务器为例。</p>
</li>
<li>
<p>下图为 PPCS 平台的服务器配置文件，<strong>PPCS</strong> 是平台名：</p>
<p><img src="picture/003/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E.png" alt=""></p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>上传程序压缩包到云主机上有两种方式，使用 WinSCP 软件和 使用 <em>scp</em> 指令上传，Windows系统使用 WinSCP 软件上传，macOS 和 Linux 系统使用 <em>scp</em> 指令上传文件。</li>
<li>WinSCP 软件上传方法，请回到上一章。</li>
<li><em>scp</em> 指令使用，<em><strong>scp [文件名] 账号@云主机IP:[云主机路径]</strong></em>
<ul>
<li><code>scp BIN_PPCS64.tgz root@123.45.67.89:/root/</code></li>
</ul>
</li>
</ul>
<h3 id="step-2">Step 2：登录云主机<a href="#step-2" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>云主机登录方式也因系统分两种方式，Windows 系统使用 Putty 软件登录，macOS 和 Linux 系统使用 <em>ssh</em> 指令登录云主机。</li>
<li>Putty 软件使用，请回到上一章。</li>
<li><em>ssh</em> 指令使用，<em><strong>ssh 账号@云主机IP</strong></em>
<ul>
<li><code>ssh root@123.45.67.89</code></li>
</ul>
</li>
</ul>
<h3 id="step-3">Step 3：解压程序压缩包<a href="#step-3" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>指令：<code>tar -zxvf BIN_PPCS64.tgz</code></li>
</ul>
<h3 id="step-4-ppc-">Step 4：创建 PPC 目录<a href="#step-4-ppc-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>指令：<code>mkdir PPC</code></li>
</ul>
<h3 id="step-5-ppc-">Step 5：移动程序文件到 PPC 目录<a href="#step-5-ppc-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>移动解压后的所有文件到 PPC 目录，并删除移动后的空文件夹
<ul>
<li>指令：<code>mv BIN_PPCS64/* PPC</code></li>
<li>删除空文件夹指令：<code>rmdir BIN_PPCS64/</code></li>
</ul>
</li>
</ul>
<h3 id="step-6-ppc--log-">Step 6：进入 PPC 目录并创建 Log 目录<a href="#step-6-ppc--log-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><strong>Log 目录是保存 P2PServer Log 的目录，程序默认是关闭 Log，需要使用管理工具打开（具体请看《TM-CS2-008_P2P-Log 日志_v1.0.0.pdf》文档），打开 Log 后会一直生成 Log 文件，程序不会做清理 Log 动作，请客户自行处理 Log 文件或使用管理工具关闭 Log。</strong></li>
<li>进入目录指令：<code>cd PPC</code></li>
<li>创建目录指令：<code>mkdir Log</code></li>
</ul>
<h3 id="step-7">Step 7：创建启动脚本<a href="#step-7" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>
<p>启动脚本用于启动 P2P 服务器程序，并保证程序一直处于运行状态。</p>
</li>
<li>
<p>PPC 平台分为带唤醒和不带唤醒两种，启动脚本也会有不同，请按实际情况选择。</p>
</li>
<li>
<p>本文使用 vim 指令创建和编辑文本，后续脚本的创建和编辑都使用该指令。</p>
</li>
<li>
<p>创建指令：<code>vim start_Server.sh</code></p>
</li>
<li>
<p>脚本内容（<strong><!-- raw HTML omitted -->程序名称因用户实际情况填写<!-- raw HTML omitted --></strong>）</p>
<ul>
<li>部署<strong>不具备唤醒休眠功能</strong>的 P2P 服务器：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="nb">cd</span> /root/PPC
<span class="nv">s</span><span class="o">=</span><span class="m">1</span>
<span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$s</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]</span>
<span class="k">do</span>
    <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ps -elf <span class="p">|</span> grep -v <span class="s2">&#34;grep&#34;</span> <span class="p">|</span> grep -c <span class="s1">&#39;PPCS_Server64&#39;</span><span class="k">)</span> <span class="o">=</span><span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    /root/PPC/PPCS_Server64 CRCKey <span class="p">&amp;</span>
    sleep <span class="m">1</span>
    <span class="c1"># 打开 log 日志, 要确定有创建 Log 目录</span>
    /root/PPC/PPCS_Management64 <span class="m">4</span> <span class="m">1</span>
    <span class="k">fi</span>
    <span class="c1"># 只保留最近 7 天的 P2P 服务器 log 日志</span>
    find /root/PPC/Log/*.log -mtime +6 -exec rm -f <span class="o">{</span><span class="o">}</span> <span class="se">\;</span>
    sleep <span class="m">5</span>
<span class="k">done</span>
</code></pre></div></li>
<li>
<p>部署<strong>具备唤醒休眠功能</strong>的 P2P 服务器：</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">  <span class="c1">#!/bin/bash</span>
  <span class="nb">cd</span> /root/PPC
  <span class="nv">s</span><span class="o">=</span><span class="m">1</span>
  <span class="nb">ulimit</span> -n <span class="m">1024000</span>
  <span class="nb">ulimit</span> -n
  <span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$s</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]</span>
  <span class="k">do</span>
      <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ps -elf <span class="p">|</span> grep -v <span class="s2">&#34;grep&#34;</span> <span class="p">|</span> grep -c <span class="s1">&#39;PPCS_Server64&#39;</span><span class="k">)</span> <span class="o">=</span><span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      /root/PPC/PPCS_Server64 CRCKey <span class="p">&amp;</span>
      sleep <span class="m">1</span>
      <span class="c1"># 打开 log 日志, 要确定有创建 Log 目录</span>
      /root/PPC/PPCS_Management64 <span class="m">4</span> <span class="m">1</span>
      <span class="k">fi</span>
      sleep <span class="m">1</span>
      <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ps -elf <span class="p">|</span> grep -v <span class="s2">&#34;grep&#34;</span> <span class="p">|</span> grep -c <span class="s1">&#39;PPCS_Wakeup_Hisi_LiteOS64&#39;</span><span class="k">)</span> <span class="o">=</span><span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      /root/PPC/PPCS_Wakeup_Hisi_LiteOS64 WakeupServerKey <span class="p">&amp;</span>
      <span class="k">fi</span>
      <span class="c1"># 只保留最近 7 天的 P2P 和 Wakeup 服务器 log 日志</span>
      find /root/PPC/*Log/*.log -mtime +6 -exec rm -f <span class="o">{</span><span class="o">}</span> <span class="se">\;</span>
      sleep <span class="m">5</span>
  <span class="k">done</span>
</code></pre></div><ul>
<li>
<p>脚本说明：</p>
<ul>
<li>**CRCKey：**用于保护用户平台而设定的。用户自定义，长度建议 6~8 个字母可大小写，可以不设置，若不设置则将此处留为空白。关于CRCKEY的详细讲解可参考P2P技术白皮书文档。</li>
<li>**WakeupServerKey：**唤醒服务器使用的 key，<strong>长度固定 16 个字节</strong>，用户自定义。用于对消息做加解密处理，由字母+数字+符号组合，字符可以选择 <strong>‘@’、‘_’、‘-’、‘,’、‘.’</strong>（这五个字符都是在英文输入下的字符）。</li>
</ul>
</li>
</ul>
<h3 id="step-8">Step 8：创建停止脚本<a href="#step-8" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>
<p>停止脚本用于停止启动脚本和服务器程序。</p>
<ul>
<li>指令：<code>vim stop_Server.sh</code></li>
</ul>
</li>
<li>
<p>脚本内容如下（<strong>若不具备唤醒休眠功能，最后一行不用添加</strong>）：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/bash
</span><span class="cp"></span>killall start_Server.sh
killall PPCS_Server64
killall PPCS_Wakeup_Hisi_LiteOS64
</code></pre></div></li>
</ul>
<h3 id="step-9-serverconf-">Step 9：创建 Server.conf 文本<a href="#step-9-serverconf-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>
<p>Server.conf 用来设定支持的前缀码与流水号数量上限。</p>
</li>
<li>
<p>Server.conf 为<strong>纯文字档</strong>，每一台部署 P2P 服务器的云主机都需要创建该文本。</p>
</li>
<li>
<p>指令：<code>vim Server.conf</code></p>
</li>
<li>
<p>Server.conf 的内容从配置文件 <strong>PPCS.txt</strong> 中获取，如下图：</p>
<p><img src="picture/003/cfgServer%E5%86%85%E5%AE%B9.png" alt=""></p>
</li>
<li>
<p>根据上图内容，Server1 的 Server.conf 内容如下：</p>
<p><img src="picture/003/Server1%E5%86%85%E5%AE%B9.png" alt=""></p>
</li>
</ul>
<h3 id="step-10-p2pkeyconf-">Step 10：创建 P2PKey.conf 文本<a href="#step-10-p2pkeyconf-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><strong><!-- raw HTML omitted -->若 PPC 平台没有使用 P2PKey，则不需要创建该文本！<!-- raw HTML omitted --></strong></li>
<li>P2PKey.conf 和 Server.conf <strong>都是纯文字档</strong>，P2PKey.conf 文本存放的是 P2PKey。</li>
<li><strong>P2PKey</strong> 用作加密 PPC 平台的所有通讯，当服务器添加了该文本时，客户端和设备端必须使用 “:” 拼接在 InitString 参数的后面使用，否则，P2P 服务器将不会有任何回应。</li>
<li>Relay 服务器上也需要创建内容一致的 P2PKey.conf 文本，否则将不能登录 P2P 服务器。</li>
<li><strong>P2PKey 为用户自定义，长度最长 20 字符，多于 20 字符的将被忽略，若创建了该文本，内容为空，则 P2PKey 为空字符串，建议长度为 10~16 个字符，因为 P2PKey 太长会加长解析的时间。</strong></li>
<li>指令：<code>vim P2PKey.conf</code></li>
</ul>
<h3 id="step-11">Step 11：设置程序开机自动运行<a href="#step-11" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>
<p>检查云主机是否有启动 systemd 管理器（<strong>下图两个进程</strong>）</p>
<ul>
<li>指令：<code>ps -A | grep systemd</code></li>
</ul>
</li>
<li>
<p>若<strong>有启动 systemd 管理器，请转方法 1</strong>，否则走方法 2。</p>
<p><img src="picture/003/%E6%A3%80%E6%9F%A5systemd.png" alt=""></p>
</li>
</ul>
<h4 id="-1">方法 1<a href="#-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<ol>
<li>
<p>检查 Ubuntu 版本</p>
<ul>
<li>
<p>指令：<code>cat /etc/issue</code></p>
</li>
<li>
<p>若检查到 Ubuntu 系统<strong>低于 18.04</strong>，请<strong>转到第 7 步</strong>继续。</p>
<p><img src="picture/003/%E6%A3%80%E6%9F%A5Ubuntu%E7%89%88%E6%9C%AC.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>创建 <strong>rc-local.service</strong> 文件</p>
<ul>
<li>指令：<code>vim /etc/systemd/system/rc-local.service</code></li>
<li>内容如下：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>/etc/rc.local Compatibility
<span class="nv">ConditionPathExists</span><span class="o">=</span>/etc/rc.local
   
<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>forking
<span class="nv">ExecStart</span><span class="o">=</span>/etc/rc.local start
<span class="nv">TimeoutSec</span><span class="o">=</span><span class="m">0</span>
<span class="nv">StandardOutput</span><span class="o">=</span>tty
<span class="nv">RemainAfterExit</span><span class="o">=</span>yes
<span class="nv">SysVStartPriority</span><span class="o">=</span><span class="m">99</span>
   
<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div></li>
<li>
<p>创建 <strong>rc.local</strong> 文件</p>
</li>
</ol>
<ul>
<li>指令：<code>vim /etc/rc.local</code></li>
<li>内容如下：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/sh -e
</span><span class="cp"></span>#
<span class="c1"># rc.local</span>
#
<span class="c1"># This script is executed at the end of each multiuser runlevel.</span>
<span class="c1"># Make sure that the script will &#34;exit 0&#34; on success or any other</span>
<span class="c1"># value on error.</span>
#
<span class="c1"># In order to enable or disable this script just change the execution</span>
<span class="c1"># bits.</span>
#
<span class="c1"># By default this script does nothing.</span>

<span class="nb">exit</span> <span class="m">0</span>
</code></pre></div><ol start="4">
<li>
<p>给 <strong>rc.local</strong> 文件增加权限</p>
<ul>
<li>指令：<code>chmod +x /etc/rc.local</code></li>
</ul>
</li>
<li>
<p>启动 <strong>systemd</strong> 服务器</p>
<ul>
<li>指令：<code>systemctl enable rc-local</code></li>
</ul>
</li>
<li>
<p>启动并检查状态</p>
<ul>
<li>启动指令：<code>systemctl start rc-local.service</code></li>
<li>检查状态指令：<code>systemctl status rc-local.service</code></li>
</ul>
</li>
<li>
<p>编辑 <em>/etc/re.local</em> 文本，<strong>若找不到该文本，请从第 2 步开始设置</strong>。</p>
<ul>
<li>指令：<code>vim /etc/rc.local</code></li>
<li>文本添加内容：<code>/root/PPC/start_Server.sh &amp;</code></li>
<li>将完整路径的启动脚本添加到文本内指定位置：</li>
</ul>
<p><img src="picture/003/%E6%B7%BB%E5%8A%A0%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC.png" alt=""></p>
</li>
<li>
<p>执行指令确保 <strong>rc.local</strong> 在系统开机时运行</p>
<ul>
<li>指令：<code>systemctl enable rc-local.service</code></li>
</ul>
</li>
</ol>
<h4 id="-2">方法 2<a href="#-2" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<ol>
<li>
<p>使用指令查看云主机运行级别，<strong>并记住查到的数字</strong>。</p>
<ul>
<li>指令：<code>runlevel</code></li>
</ul>
<p><img src="picture/003/runlevel%E7%BA%A7%E5%88%AB.png" alt=""></p>
</li>
<li>
<p>创建设置开机自动运行脚本。</p>
<ul>
<li>指令：<code>vim set_AutoRun.sh</code></li>
<li>脚本内容（<strong>根据上一步获取的运行级别，替换脚本中的“/etc/rcN.d”中的“N”值</strong>）：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/bash
</span><span class="cp"></span>chmod <span class="m">755</span> /root/PPC/*
<span class="nb">echo</span> <span class="s2">&#34;/root/PPC/start_Server.sh &amp;&#34;</span> &gt; /etc/init.d/startServer.sh
chmod <span class="m">755</span> /etc/init.d/startServer.sh
<span class="nb">cd</span> /etc/rcN.d
ln -s ../init.d/startServer.sh S82startServer.sh
</code></pre></div></li>
<li>
<p>为脚本添加可执行权限</p>
<ul>
<li>指令：<code>chmod +x set_AutoRun.sh</code></li>
</ul>
</li>
<li>
<p>运行脚本</p>
<ul>
<li>指令：<code>./set_AutoRun.sh</code></li>
</ul>
</li>
<li>
<p>修改 <strong>/etc/init.d/startServer.sh</strong></p>
<ul>
<li>由于 Ubuntu16.04 的新特性，在执行完 set_AutoRun.sh 后需要修改 /etc/init.d/startServer.sh</li>
<li>指令：<code>vim /etc/init.d/startServer.sh</code></li>
<li>在脚本开头新增内容：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides: CS2</span>
<span class="c1"># Required-Start: $local_fs</span>
<span class="c1"># Required-Stop: $local_fs</span>
<span class="c1"># Default-Start: 2 3 4 5</span>
<span class="c1"># Default-Stop: 0 1 6</span>
<span class="c1"># Short-Description: CS2 P2P Service</span>
</code></pre></div></li>
<li>
<p>查看是否有生成 <strong>/etc/rc5.d/S82startServer.sh</strong> 软链接</p>
<ul>
<li>指令：<code>cd /etc/rc5.d;ls</code></li>
</ul>
</li>
</ol>
<h3 id="step-12">Step 12：为脚本添加可执行权限<a href="#step-12" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>为新增的脚本添加可执行权限</li>
<li>指令：<code>chmod +x *sh</code></li>
</ul>
<h3 id="step-13">Step 13：后台运行启动脚本<a href="#step-13" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>指令：<code>./start_Server.sh &amp;</code></li>
</ul>
<h3 id="step-14">Step 14：检查脚本和程序是否运行<a href="#step-14" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>可直接检索脚本和程序<strong>共同关键字</strong>，检查脚本和程序是否正在运行。</li>
<li>指令：<code>ps -A | grep Server</code></li>
</ul>
<p>###Step 15：重启云主机，验证开机是否运行</p>
<ul>
<li>本步骤测试云主机重启后程序是否正常运行。</li>
<li>云主机重启指令：<code>reboot</code></li>
<li>重启云主机后，等待 10s 后再次登录云主机。</li>
<li>检查启动脚本和 P2P 程序是否运行。</li>
<li>指令：<code>ps -A | grep Server</code></li>
</ul>
<h3 id="step-16-p2p-">Step 16：查看 P2P 服务器的配置信息<a href="#step-16-p2p-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>部署好或者调整了 P2P 服务器，需要检查服务器的配置信息是否正确时，可以打印 <strong>/dev/shm/Server.inf</strong> 文本，查看当前运行的 P2P 服务器的配置信息。</li>
<li>指令：<code>cat /dev/shm/Server.inf</code></li>
</ul>
<h3 id="step-17-exit-">Step 17：执行指令 exit 退出云主机<a href="#step-17-exit-" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><strong><!-- raw HTML omitted -->这一步非常重要！运行服务器程序后，需要按 “exit” 指令退出，若直接关闭窗口会出现运行的程序同时关闭的情况！！<!-- raw HTML omitted --></strong></li>
<li>指令：<code>exit</code></li>
</ul>
<h3 id="step-18">Step 18：测试服务器<a href="#step-18" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><strong>测试服务器需要将平台的所有服务器都部署完成后，再开始测试。</strong></li>
<li>测试步骤请参考文档《TM-CS2-005_平台服务器测试》。</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>进入文件：<code>cd [目录]</code>
<ul>
<li>进入上一级目录：<code>cd ..</code></li>
</ul>
</li>
<li>移动文件：<code>mv</code>
<ul>
<li><code>mv [文件名] [目录]</code></li>
</ul>
</li>
<li>创建文件夹：<code>mkdir</code></li>
<li>删除空文件夹：<code>rmdir</code></li>
<li>杀掉一个进程：<code>kill PID</code>
<ul>
<li>杀掉同名的所有进程：<code>killall [进程名称]</code></li>
</ul>
</li>
<li>查看文件内容：<code>cat [文件名]</code></li>
<li>查看当前所在目录路径：<code>pwd</code></li>
<li>结束当前运÷行的进程：<code>ctrl(按键)+c</code></li>
<li>更改文件或文件夹权限：<code>chmod +</code></li>
<li>添加可执行权限：<code>chmod +x [文件名]</code></li>
<li>查看运行的进程：<code>ps -A</code></li>
<li>文本搜索：<code>grep</code></li>
<li>重启服务器：<code>reboot</code>（当前只有一个用户登录云主机的时候可以使用这一指
令重启服务器）</li>
<li>一分钟后重启云主机（较为安全的重启指令）：<code>shutdown –r +1</code></li>
</ul>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>3659 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>6129-126&#43;08 120:00 &#43;0800</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="prev-post" href="https://yichen813.github.io/posts/the-figure-shortcode/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>The &#34;figure&#34; Shortcode</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://yichen813.github.io">yichen</a> &#183; <a href="" target="" rel="">简单的程序狗</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://yichen813.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://yichen813.github.io/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js" integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin="anonymous"></script>
	

</body>

</html>
